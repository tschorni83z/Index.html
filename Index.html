<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Carnage: Craft & Mine</title>
    <style>
        :root { --gold: #f1c40f; --bg: #121212; --panel: #222; --blue: #3498db; --red: #e74c3c; --green: #2ecc71; }
        body { background: var(--bg); color: #e0e0e0; font-family: sans-serif; margin: 0; padding: 10px; font-size: 14px; }
        .panel { background: var(--panel); padding: 12px; border-radius: 10px; border: 1px solid #333; margin-bottom: 8px; }
        .res-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; font-size: 11px; margin-top: 5px; color: #aaa; }
        #log { height: 100px; overflow-y: auto; background: #000; padding: 10px; font-size: 12px; border: 1px solid #333; margin-bottom: 8px; }
        .screen { display: none; } .active { display: block; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        button { padding: 12px; background: #333; color: #fff; border: 1px solid #555; border-radius: 6px; font-weight: bold; }
        .btn-hunt { background: #6d214f; border: none; grid-column: span 2; margin-bottom: 5px; }
        .btn-move { background: var(--blue); border: none; }
        .btn-craft { background: #d35400; border: none; }
        .selected { background: #e67e22 !important; }
        .loc-title { font-size: 18px; color: var(--gold); text-align: center; display: block; margin-bottom: 10px; }
    </style>
</head>
<body>

    <div class="panel">
        <div style="display:flex; justify-content:space-between; font-weight:bold;">
            <span>–£—Ä. <span id="lvl">1</span></span>
            <span>üí∞ <span id="gold">0</span> | üè¶ <span id="bank">0</span></span>
        </div>
        <div class="res-grid">
            <span>ü™µ –î–µ—Ä–µ–≤–æ: <b id="r-wood">0</b></span>
            <span>ü™® –ö–∞–º–µ–Ω—å: <b id="r-stone">0</b></span>
            <span>‚õìÔ∏è –ñ–µ–ª–µ–∑–æ: <b id="r-iron">0</b></span>
        </div>
    </div>

    <div id="log">–ó–∞–≥—Ä—É–∑–∫–∞ –º–∏—Ä–∞...</div>

    <div id="scr-world" class="screen active">
        <span class="loc-title" id="loc-name">–õ–æ–∫–∞—Ü–∏—è</span>
        <button id="btn-hunt" class="btn-hunt" onclick="hunt()">üîç –ù–ê–ô–¢–ò –ú–û–ù–°–¢–†–ê</button>  
        <div class="grid" id="nav-btns"></div>
        <div id="act-btns" class="grid" style="margin-top:8px;"></div>
    </div>

    <div id="scr-battle" class="screen">
        <span class="loc-header">‚öîÔ∏è –ë–û–ô –° –í–†–ê–ì–û–ú</span>
        <div class="grid">
            <button id="atk1" onclick="sel('atk',1,'–ì–æ–ª–æ–≤–∞')">–ê—Ç–∫: –ì–æ–ª–æ–≤–∞</button>
            <button id="def1" onclick="sel('def',1,'–ì–æ–ª–æ–≤–∞')">–ó–∞—â: –ì–æ–ª–æ–≤–∞</button>
            <button id="atk2" onclick="sel('atk',2,'–¢–µ–ª–æ')">–ê—Ç–∫: –¢–µ–ª–æ</button>
            <button id="def2" onclick="sel('def',2,'–¢–µ–ª–æ')">–ó–∞—â: –¢–µ–ª–æ</button>
            <button style="grid-column:span 2; background:var(--red)" onclick="doTurn()">–£–î–ê–†–ò–¢–¨</button>
        </div>
    </div>

    <script>
        const world = {
            'town': { n: '–ì–æ—Ä–æ–¥ (–ë–µ–∑–æ–ø–∞—Å–Ω–æ)', paths: ['forest_res', 'mine', 'forest_danger', 'bank'], acts: [{t: '–ö—Ä–∞—Ñ—Ç: –ú–µ—á (10 –¥–µ—Ä–µ–≤–∞/5 –∂–µ–ª)', f: 'craft'}] },
            'bank': { n: '–ë–∞–Ω–∫', paths: ['town'], acts: [{t: '–í–Ω–µ—Å—Ç–∏ –≤—Å—ë', f: 'dep'}, {t: '–ó–∞–±—Ä–∞—Ç—å –≤—Å—ë', f: 'with'}] },
            'forest_res': { n: '–õ–µ—Å —Ä–µ—Å—É—Ä—Å–æ–≤ (–ú–∏—Ä–Ω–æ)', paths: ['town'], acts: [{t: '–†—É–±–∏—Ç—å –¥–µ—Ä–µ–≤–æ', f: 'gather_wood'}] },
            'mine': { n: '–®–∞—Ö—Ç–∞ (–ú–∏—Ä–Ω–æ)', paths: ['town'], acts: [{t: '–î–æ–±—ã–≤–∞—Ç—å –∫–∞–º–µ–Ω—å', f: 'gather_stone'}, {t: '–ò—Å–∫–∞—Ç—å –∂–µ–ª–µ–∑–æ', f: 'gather_iron'}] },
            'forest_danger': { n: '–î–∏–∫–∏–π –õ–µ—Å (–û–ø–∞—Å–Ω–æ)', paths: ['town'], mob: '–û—Ä–∫', hp: 80 }
        };

        let p = JSON.parse(localStorage.getItem('c_save_v4')) || {
            hp: 100, mH: 100, g: 20, b: 0, lvl: 1, loc: 'town',
            wood: 0, stone: 0, iron: 0, dmgBonus: 0
        };
        let enemy = null, sAtk = '', sDef = '';

        function move(k) {
            p.loc = k; const l = world[k];
            document.getElementById('loc-name').innerText = l.n;
            document.getElementById('btn-hunt').style.display = l.mob ? 'block' : 'none';
            
            const nB = document.getElementById('nav-btns'); nB.innerHTML = '';
            l.paths.forEach(pk => {
                let b = document.createElement('button'); b.className = 'btn-move';
                b.innerText = `‚û° ${world[pk].n}`; b.onclick = () => move(pk);
                nB.appendChild(b);
            });

            const aB = document.getElementById('act-btns'); aB.innerHTML = '';
            if(l.acts) l.acts.forEach(a => {
                let b = document.createElement('button'); b.className = 'btn-craft';
                b.innerText = a.t; b.onclick = () => window[a.f]();
                aB.appendChild(b);
            });
            update();
        }

        // –†–µ—Å—É—Ä—Å—ã
        window.gather_wood = () => { p.wood += 2; addLog("ü™ì –°—Ä—É–±–ª–µ–Ω–æ 2 –¥–µ—Ä–µ–≤–∞."); update(); };
        window.gather_stone = () => { p.stone += 2; addLog("‚õèÔ∏è –î–æ–±—ã—Ç–æ 2 –∫–∞–º–Ω—è."); update(); };
        window.gather_iron = () => { if(Math.random()>0.5){ p.iron += 1; addLog("‚õìÔ∏è –ù–∞–π–¥–µ–Ω–æ –∂–µ–ª–µ–∑–æ!"); } else addLog("...—Ç–æ–ª—å–∫–æ –ø—É—Å—Ç–∞—è –ø–æ—Ä–æ–¥–∞."); update(); };
        
        window.craft = () => {
            if(p.wood >= 10 && p.iron >= 5) {
                p.wood -= 10; p.iron -= 5; p.dmgBonus += 15;
                addLog("‚öîÔ∏è –í—ã —Å–∫–æ–≤–∞–ª–∏ –°—Ç–∞–ª—å–Ω–æ–π –ú–µ—á! –£—Ä–æ–Ω +15");
            } else addLog("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ä–µ—Å—É—Ä—Å–æ–≤!");
            update();
        };

        window.dep = () => { p.b += p.g; p.g = 0; update(); };
        window.with = () => { p.g += p.b; p.b = 0; update(); };

        function hunt() {
            const l = world[p.loc];
            if(l.mob) startBattle(l.mob, l.hp + (p.lvl*10));
        }

        function startBattle(n, h) {
            enemy = { n, hp: h, max: h, dmg: 10 + p.lvl };
            document.getElementById('scr-world').classList.remove('active');
            document.getElementById('scr-battle').classList.add('active');
            addLog(`üëπ –ù–∞—à–µ–ª—Å—è ${n}! –í –±–æ–π!`);
        }

        function sel(t, i, n) {
            for(let j=1; j<=2; j++) document.getElementById(t+j).classList.remove('selected');
            document.getElementById(t+i).classList.add('selected');
            if(t==='atk') sAtk = n; else sDef = n;
        }

        function doTurn() {
            if(!sAtk || !sDef) return;
            let d = 10 + p.lvl + p.dmgBonus;
            enemy.hp -= d; addLog(`–£–¥–∞—Ä: -${d} HP.`);
            if(enemy.hp <= 0) {
                p.g += 30; addLog("–ü–æ–±–µ–¥–∞! +30üí∞");
                document.getElementById('scr-battle').classList.remove('active');
                document.getElementById('scr-world').classList.add('active');
            } else {
                p.hp -= enemy.dmg; addLog(`–í—Ä–∞–≥ —Ä–∞–Ω–∏–ª –≤–∞—Å –Ω–∞ ${enemy.dmg}`);
            }
            if(p.hp <= 0) { p.hp = 100; p.g = 0; move('town'); }
            update();
        }
‚ñ†
        function addLog(m) {
            const l = document.getElementById('log');
            l.innerHTML += `<div>${m}</div>`; l.scrollTop = l.scrollHeight;
        }

        function update() {
            document.getElementById('gold').innerText = p.g;
            document.getElementById('bank').innerText = p.b;
            document.getElementById('r-wood').innerText = p.wood;
            document.getElementById('r-stone').innerText = p.stone;
            document.getElementById('r-iron').innerText = p.iron;
            localStorage.setItem('c_save_v4', JSON.stringify(p));
        }

        move('town');
    </script>
</body>
</html>
