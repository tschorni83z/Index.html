<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TSCHORNI GAME ONLINE</title>
    <style>
        :root { --gold: #f1c40f; --bg: #0d0d0d; --panel: #1a1a1a; --blue: #3498db; --red: #e74c3c; --green: #2ecc71; --stamina: #9b59b6; --border: #333; }
        body { background: var(--bg); color: #ddd; font-family: 'Verdana', sans-serif; margin: 0; padding-bottom: 80px; user-select: none; }
        
        .header { background: #000; padding: 10px; border-bottom: 2px solid var(--border); position: sticky; top: 0; z-index: 100; }
        .game-title { text-align: center; color: var(--gold); font-size: 14px; font-weight: bold; letter-spacing: 1px; margin-bottom: 8px; text-transform: uppercase; }
        
        .bar-bg { height: 12px; background: #222; border-radius: 6px; border: 1px solid #444; overflow: hidden; margin: 4px 0; position: relative; }
        .fill { height: 100%; transition: 0.3s; width: 100%; }
        .bar-txt { position: absolute; width: 100%; text-align: center; font-size: 9px; line-height: 12px; font-weight: bold; color: #fff; z-index: 2; }
        
        .panel { background: var(--panel); border: 1px solid var(--border); border-radius: 8px; padding: 10px; margin-bottom: 10px; }
        .screen { display: none; } .active { display: block; }
        
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        button { padding: 12px; background: #2a2a2a; color: #eee; border: 1px solid #444; border-radius: 5px; font-size: 11px; font-weight: bold; cursor: pointer; transition: 0.2s; }
        button:active { transform: scale(0.98); background: #333; }

        #log { height: 120px; overflow-y: auto; background: #000; padding: 8px; font-size: 11px; color: #888; border: 1px solid var(--border); margin-bottom: 10px; line-height: 1.4; }
        
        .nav-bar { position: fixed; bottom: 0; width: 100%; background: #000; display: flex; border-top: 2px solid var(--border); height: 60px; }
        .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 10px; color: #555; cursor: pointer; }
        .nav-item.active { color: var(--gold); background: #111; border-top: 2px solid var(--gold); }
    </style>
</head>
<body>

    <div class="header">
        <div class="game-title">TSCHORNI GAME ONLINE</div>
        <div style="display:flex; justify-content:space-between; font-size:11px; color:var(--gold); margin-bottom:4px;">
            <b id="ui-nick">---</b>
            <b>üí∞ <span id="gold">0</span></b>
        </div>
        <div class="bar-bg"><div class="bar-txt">‚ù§Ô∏è HP: <span id="hp-val">0/0</span></div><div id="hp-fill" class="fill" style="background:var(--green)"></div></div>
        <div class="bar-bg"><div class="bar-txt">üí™ STAMINA: <span id="st-val">0/0</span></div><div id="st-fill" class="fill" style="background:var(--stamina)"></div></div>
        <div style="text-align:center; font-size:9px; color:#666;">Level: <span id="ui-lvl">1</span></div>
    </div>

    <div class="content" style="padding:10px;">
        <div id="log"></div>

        <div id="scr-town" class="screen">
            <div class="panel">
                <h4 style="text-align:center; margin:0 0 10px 0;">üèôÔ∏è –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –ö–≤–∞—Ä—Ç–∞–ª</h4>
                <div class="grid">
                    <button onclick="move('shop')">‚öñÔ∏è –ú–∞–≥–∞–∑–∏–Ω</button>
                    <button onclick="move('hospital')">üè• –ë–æ–ª—å–Ω–∏—Ü–∞</button>
                </div>
            </div>
            <button style="width:100%; background:var(--blue); margin-top:10px; border:none;" onclick="move('world')">üß≠ –í—ã–π—Ç–∏ –Ω–∞ –æ—Ö–æ—Ç—É</button>
        </div>

        <div id="scr-world" class="screen">
            <h4 style="text-align:center;">üó∫Ô∏è –õ–æ–∫–∞—Ü–∏—è: <span id="loc-title">–î–∏–∫–∏–µ –∑–µ–º–ª–∏</span></h4>
            <button style="width:100%; background:var(--red); height:60px; border:none; font-size:14px;" onclick="hunt()">‚öîÔ∏è –ù–ê–ô–¢–ò –¶–ï–õ–¨</button>
            <button style="width:100%; margin-top:15px;" onclick="move('town')">üèÉ –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –≥–æ—Ä–æ–¥</button>
        </div>

        <div id="scr-battle" class="screen">
            <div class="panel" style="text-align:center; border-color:var(--red);">
                <div id="en-img" style="font-size:50px; margin-bottom:10px;">üëæ</div>
                <h3 id="en-name" style="margin:5px 0; color:var(--red);">–ü—Ä–æ—Ç–∏–≤–Ω–∏–∫</h3>
                <div class="bar-bg" style="width:80%; margin:0 auto;"><div id="en-hp-fill" class="fill" style="background:var(--red)"></div></div>
                <p id="battle-status" style="font-size:10px; color:#666;">–ò–¥–µ—Ç –±–æ–π...</p>
                <div class="grid" style="margin-top:15px;">
                    <button onclick="battleHit()" id="hit-btn" style="background:var(--red); border:none; height:50px;">–£–î–ê–†–ò–¢–¨</button>
                    <button onclick="flee()" style="background:#000;">–°–ë–ï–ñ–ê–¢–¨</button>
                </div>
            </div>
        </div>

        <div id="scr-char" class="screen">
            <div class="panel">
                <h4 style="margin:0 0 10px 0; color:var(--gold);">üë§ –ü—Ä–æ—Ñ–∏–ª—å –∏–≥—Ä–æ–∫–∞</h4>
                <div id="char-stats-list"></div>
            </div>
        </div>
    </div>

    <div class="nav-bar">
        <div id="nav-town" class="nav-item" onclick="move('town')">üèôÔ∏è<br>–ì–æ—Ä–æ–¥</div>
        <div id="nav-world" class="nav-item" onclick="move('world')">üó∫Ô∏è<br>–ú–∏—Ä</div>
        <div id="nav-char" class="nav-item" onclick="move('char')">üë§<br>–ì–µ—Ä–æ–π</div>
    </div>

    <script>
        const SB_URL = "https://xgnzgapvvulizxtqdyzn.supabase.co"; 
        const SB_KEY = "sb_publishable_DtZvknbQ-Cy2mDqN6G-kfg_yLavMwLT";

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è (–≤–∫–ª—é—á–∞—è —Ç–µ–∫—É—â–∏–π –±–æ–π)
        let p = JSON.parse(localStorage.getItem('save_v_tschorni')) || {
            username: "Player", hp:100, st:100, gold:100, exp:0, lvl:1, points:5,
            str:5, agi:5, vit:5, int:5, loc: 'town',
            enemy: null 
        };

        const mobs = [
            {n:'–õ–µ—Å–Ω–æ–π –≥—Ä–∞–±–∏—Ç–µ–ª—å', i:'üë§', hp:60, dmg:7, exp:25, g:15},
            {n:'–î–∏–∫–∏–π –í–µ–ø—Ä—å', i:'üêó', hp:45, dmg:5, exp:15, g:8}
        ];

        function addLog(m) {
            const l = document.getElementById('log');
            l.innerHTML += `<div><span style="color:#555">[${new Date().toLocaleTimeString()}]</span> ${m}</div>`;
            l.scrollTop = l.scrollHeight;
        }

        function updateUI() {
            let maxHp = 100 + p.vit * 20;
            document.getElementById('ui-nick').innerText = p.username;
            document.getElementById('gold').innerText = Math.floor(p.gold);
            document.getElementById('ui-lvl').innerText = p.lvl;
            document.getElementById('hp-val').innerText = `${Math.ceil(p.hp)}/${maxHp}`;
            document.getElementById('hp-fill').style.width = (p.hp/maxHp*100)+'%';
            document.getElementById('st-val').innerText = `${Math.floor(p.st)}/100`;
            document.getElementById('st-fill').style.width = p.st+'%';

            if(p.enemy) {
                document.getElementById('en-hp-fill').style.width = (p.enemy.curHp/p.enemy.hp*100)+'%';
                document.getElementById('en-name').innerText = p.enemy.n;
                document.getElementById('en-img').innerText = p.enemy.i;
            }
        }

        function move(scr) {
            // –ó–∞—â–∏—Ç–∞: –µ—Å–ª–∏ –∏–≥—Ä–æ–∫ –≤ –±–æ—é, –æ–Ω –Ω–µ –º–æ–∂–µ—Ç —É–π—Ç–∏ –≤ –º–∞–≥–∞–∑–∏–Ω –∏–ª–∏ –≥–æ—Ä–æ–¥
            if(p.enemy && (scr === 'town' || scr === 'shop' || scr === 'hospital')) {
                addLog("‚öîÔ∏è –í—ã –Ω–µ –º–æ–∂–µ—Ç–µ —É–π—Ç–∏, –ø–æ–∫–∞ –∏–¥–µ—Ç –±–æ–π!");
                scr = 'battle';
            }
            
            p.loc = (scr === 'battle') ? p.loc : scr;
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            
            const target = document.getElementById('scr-' + scr);
            if(target) target.classList.add('active');
            
            const nav = document.getElementById('nav-' + (scr === 'battle' ? 'world' : (scr === 'shop' ? 'town' : scr)));
            if(nav) nav.classList.add('active');
            
            updateUI();
            save();
        }

        function hunt() {
            if(p.hp < 20) return addLog("üè• –í—ã —Å–ª–∏—à–∫–æ–º —Ä–∞–Ω–µ–Ω—ã! –ù—É–∂–Ω–æ –ø–æ–¥–ª–µ—á–∏—Ç—å—Å—è.");
            const m = mobs[Math.floor(Math.random()*mobs.length)];
            p.enemy = { ...m, curHp: m.hp };
            addLog(`‚öîÔ∏è –í–Ω–∏–º–∞–Ω–∏–µ! –ù–∞ –≤–∞—Å –Ω–∞–ø–∞–ª <b>${p.enemy.n}</b>!`);
            move('battle');
        }

        function battleHit() {
            if(!p.enemy) return;

            // –õ–æ–≥–∏–∫–∞ —É—Ä–æ–Ω–∞: –µ—Å–ª–∏ —Å—Ç–∞–º–∏–Ω—ã –º–∞–ª–æ, —É—Ä–æ–Ω –º–∏–Ω–∏–º–∞–ª–µ–Ω, –Ω–æ –±–∏—Ç—å –º–æ–∂–Ω–æ
            let isExhausted = p.st < 10;
            let dmg = isExhausted ? (Math.floor(Math.random()*2)+1) : (p.str + Math.floor(Math.random()*5));
            
            if(!isExhausted) p.st -= 10; 
            else addLog("üí® –í—ã –≤—ã–¥–æ—Ö–ª–∏—Å—å! –£–¥–∞—Ä—ã —Å—Ç–∞–ª–∏ —Å–ª–∞–±—ã–º–∏...");

            p.enemy.curHp -= dmg;
            addLog(`–í—ã —É–¥–∞—Ä–∏–ª–∏ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞ –Ω–∞ <b>${dmg}</b> —É—Ä–æ–Ω–∞.`);

            if(p.enemy.curHp <= 0) {
                addLog(`üèÜ –ü–æ–±–µ–¥–∞! –í—ã –ø–æ–ª—É—á–∏–ª–∏ ${p.enemy.exp} –æ–ø—ã—Ç–∞ –∏ ${p.enemy.g} –∑–æ–ª–æ—Ç–∞.`);
                p.exp += p.enemy.exp; p.gold += p.enemy.g;
                p.enemy = null;
                checkLvl();
                save();
                return move('world');
            }

            // –•–æ–¥ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞
            let eDmg = Math.max(1, p.enemy.dmg - Math.floor(p.vit/4));
            p.hp -= eDmg;
            addLog(`${p.enemy.n} –Ω–∞–Ω–µ—Å –≤–∞–º <b>${eDmg}</b> —É—Ä–æ–Ω–∞.`);

            if(p.hp <= 0) {
                p.hp = 20; p.enemy = null;
                addLog("üíÄ –í—ã –ø–æ—Ç–µ—Ä—è–ª–∏ —Å–æ–∑–Ω–∞–Ω–∏–µ –∏ –ø—Ä–∏—à–ª–∏ –≤ —Å–µ–±—è –≤ –≥–æ—Ä–æ–¥–µ...");
                move('town');
            }
            updateUI();
            save();
        }

        function checkLvl() {
            let next = p.lvl * 200;
            if(p.exp >= next) {
                p.lvl++; p.points += 3;
                addLog(`üéä –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í–∞—à —É—Ä–æ–≤–µ–Ω—å –ø–æ–≤—ã—à–µ–Ω –¥–æ <b>${p.lvl}</b>!`);
            }
        }

        function flee() {
            if(Math.random() > 0.5) {
                p.enemy = null;
                addLog("üè≥Ô∏è –í–∞–º —É–¥–∞–ª–æ—Å—å —É—Å–ø–µ—à–Ω–æ —Å–±–µ–∂–∞—Ç—å.");
                move('world');
            } else {
                addLog("üö´ –ù–µ —É–¥–∞–ª–æ—Å—å —Å–±–µ–∂–∞—Ç—å! –í—Ä–∞–≥ –ø—Ä–µ–≥—Ä–∞–¥–∏–ª –ø—É—Ç—å.");
                battleHit(); // –í—Ä–∞–≥ –±—å–µ—Ç –ø—Ä–∏ –Ω–µ—É–¥–∞—á–Ω–æ–º –ø–æ–±–µ–≥–µ
            }
        }

        async function save() {
            localStorage.setItem('save_v_tschorni', JSON.stringify(p));
            try {
                await fetch(`${SB_URL}/rest/v1/users?username=eq.${p.username}`, {
                    method: 'PATCH',
                    headers: { "apikey": SB_KEY, "Authorization": `Bearer ${SB_KEY}`, "Content-Type": "application/json" },
                    body: JSON.stringify({ save_data: p })
                });
            } catch(e) {}
        }

        // –†–ï–ì–ï–ù–ï–†–ê–¶–ò–Ø (—Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∂–¥—ã–µ 4 —Å–µ–∫—É–Ω–¥—ã)
        setInterval(() => {
            let maxHp = 100 + p.vit * 20;
            if(!p.enemy) {
                // –í–Ω–µ –±–æ—è –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º—Å—è –±—ã—Å—Ç—Ä–æ
                if(p.hp < maxHp) p.hp = Math.min(maxHp, p.hp + 4);
                if(p.st < 100) p.st = Math.min(100, p.st + 10);
            } else {
                // –í –±–æ—é –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ 1 —Å—Ç–∞–º–∏–Ω–∞ (—á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –±–∏—Ç—å)
                if(p.st < 100) p.st = Math.min(100, p.st + 2);
            }
            updateUI();
        }, 4000);

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
        window.onload = () => {
            addLog("–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ <b>TSCHORNI GAME ONLINE</b>!");
            if(p.enemy) {
                addLog("‚öîÔ∏è –ë–æ–π –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è...");
                move('battle');
            } else {
                move(p.loc || 'town');
            }
        };
    </script>
</body>
</html>
