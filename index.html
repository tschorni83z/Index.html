<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TSCHORNI WORLD</title>
  <style>
    body {
      margin:0; padding:0; background:#000; color:#0f0; font-family:monospace;
      image-rendering:pixelated; overflow:hidden; user-select:none;
    }
    #ui {
      position:fixed; inset:0; pointer-events:none; z-index:10;
      display:flex; flex-direction:column; justify-content:space-between;
      padding:8px; box-sizing:border-box;
    }
    #header {
      text-align:center; font-size:24px; color:#ff0; text-shadow:0 0 10px #ff0;
      margin-bottom:8px;
    }
    #top {
      display:flex; justify-content:space-between; font-size:14px;
    }
    #bottom {
      display:flex; flex-wrap:wrap; gap:6px; pointer-events:auto;
    }
    button {
      pointer-events:auto; background:#000; color:#0f0; border:1px solid #0f0;
      padding:6px 10px; cursor:pointer; font-family:monospace; font-size:13px;
    }
    button:hover { background:#0a0; color:#000; }
    button:disabled { opacity:0.4; cursor:not-allowed; }
    #log {
      max-height:140px; overflow-y:auto; font-size:12px; color:#0f8;
      margin-top:8px; pointer-events:none; text-shadow:0 0 3px #000;
    }
    #inv, #craft, #shop {
      position:fixed; top:50%; left:50%; transform:translate(-50%,-50%);
      background:#111; border:2px solid #0f0; padding:16px; color:#0f0;
      max-width:90%; max-height:80vh; overflow:auto; z-index:20;
      display:none; pointer-events:auto;
    }
    .item { margin:6px 0; padding:6px; border:1px solid #333; background:#0008; }
    .eq { background:#004400; }
  </style>
</head>
<body>

<div id="ui">
  <div id="header">TSCHORNI WORLD</div>

  <div id="top">
    <div>
      <span id="name">Безымянный</span> 
      <span id="lvl">1 ур.</span> 
      <span id="hp">100/100</span>
    </div>
    <div>
      <span id="loc">Лагерь</span> 
      <span id="gold">0 зол.</span>
    </div>
  </div>

  <div id="log"></div>

  <div id="bottom">
    <button onclick="go('Лагерь')">Лагерь</button>
    <button onclick="go('Лес')">Лес</button>
    <button onclick="go('Шахта')">Шахта</button>
    <button onclick="go('Город')">Город</button>
    <button onclick="showInv()">Инвентарь</button>
    <button onclick="showCraft()">Крафт</button>
    <button onclick="showShop()">Магазин</button>
    <button onclick="die()">Умереть</button>
  </div>
</div>

<div id="inv">
  <h3>Инвентарь</h3>
  <div id="inv-list"></div>
  <h3>Экипировка</h3>
  <div id="equip-list"></div>
  <hr/>
  <button onclick="closeInv()">Закрыть</button>
</div>

<div id="craft">
  <h3>Крафт</h3>
  <div id="craft-list"></div>
  <hr/>
  <button onclick="closeCraft()">Закрыть</button>
</div>

<div id="shop">
  <h3>Магазин</h3>
  <div id="shop-list"></div>
  <hr/>
  <button onclick="closeShop()">Закрыть</button>
</div>

<script>
// ==================================================
// ДАННЫЕ ИГРОКА (сохранение)
// ==================================================
let player = JSON.parse(localStorage.getItem('tschorniWorld')) || {
  name: "Безымянный",
  level: 1,
  exp: 0,
  expToNext: 100,
  hp: 100,
  maxHp: 100,
  gold: 0,
  str: 5,
  vit: 5,
  location: "Лагерь",
  inventory: [
    {id:"rKnife", name:"Ржавый нож", type:"weapon", str:3, count:1},
    {id:"rags", name:"Тряпьё", type:"armor", vit:2, count:1}
  ],
  equip: {
    weapon: {id:"rKnife", name:"Ржавый нож", str:3},
    armor: {id:"rags", name:"Тряпьё", vit:2}
  },
  resources: { wood:0, ore:0, herb:0 }
};

function save() {
  localStorage.setItem('tschorniWorld', JSON.stringify(player));
}

// ==================================================
// ЛОГ
// ==================================================
function log(txt, color = '#0f8') {
  let div = document.createElement('div');
  div.textContent = txt;
  div.style.color = color;
  document.getElementById('log').appendChild(div);
  div.scrollIntoView({behavior:'smooth'});
  if (document.getElementById('log').children.length > 20) {
    document.getElementById('log').removeChild(document.getElementById('log').firstChild);
  }
}

// ==================================================
// ОБНОВЛЕНИЕ ИНТЕРФЕЙСА
// ==================================================
function updateUI() {
  document.getElementById('name').textContent = player.name;
  document.getElementById('lvl').textContent = `${player.level} ур.`;
  document.getElementById('hp').textContent = `${Math.max(0,player.hp)}/${player.maxHp}`;
  document.getElementById('loc').textContent = player.location;
  document.getElementById('gold').textContent = `${player.gold} зол.`;
}

// ==================================================
// ПЕРЕХОД В ЛОКАЦИЮ
// ==================================================
function go(location) {
  if (player.location === location) return;
  player.location = location;
  log(`Вы прибыли в ${location}`, '#0ff');
  updateUI();
  renderMobs();
}

// ==================================================
// МОБЫ И БОЙ
// ==================================================
let mobs = [];

function renderMobs() {
  let c = document.getElementById('tab-content') || document.createElement('div');
  c.innerHTML = '<h4>Противники</h4>';
  if (mobs.length === 0) {
    c.innerHTML += '<p>Здесь пусто... Пока.</p>';
  }
  mobs.forEach((m,i) => {
    let perc = (m.hp / m.maxHp * 100).toFixed(0);
    c.innerHTML += `
      <div style="margin:6px 0;">
        ${m.name} (${m.hp}/${m.maxHp}) 
        <button onclick="hitMob(${i})">Ударить (${player.str + (player.equip.weapon?.str || 0)} dmg)</button>
      </div>`;
  });
  if (!document.getElementById('tab-content')) document.body.appendChild(c);
}

function hitMob(index) {
  if (!mobs[index] || player.hp <= 0) return;
  let mob = mobs[index];
  let dmg = player.str + (player.equip.weapon?.str || 0) + Math.floor(Math.random()*6);
  mob.hp -= dmg;
  log(`→ ${dmg} урона ${mob.name}`, '#ff0');

  if (mob.hp <= 0) {
    log(`Убит ${mob.name}!`, '#0ff');
    player.exp += mob.exp;
    player.gold += mob.gold;
    for (let res in mob.res) {
      player.resources[res] = (player.resources[res] || 0) + mob.res[res];
    }
    mobs.splice(index, 1);

    // прокачка уровня
    while (player.exp >= player.expToNext) {
      player.level++;
      player.exp -= player.expToNext;
      player.expToNext = Math.floor(player.expToNext * 1.7);
      player.str += 2;
      player.vit += 2;
      player.maxHp += 30;
      player.hp = player.maxHp;
      log(`Уровень ${player.level}! +2 STR +2 VIT +30 HP`, '#ff0');
    }
  } else {
    let mobDmg = Math.max(1, mob.dmg - Math.floor(player.vit/3) - (player.equip.armor?.vit || 0));
    player.hp -= mobDmg;
    log(`${mob.name} → ${mobDmg}`, '#f44');
    if (player.hp <= 0) {
      log('Вы мертвы!', '#f00');
      player.hp = 1;
    }
  }

  updateUI();
  renderMobs();
}

// ==================================================
// ИНИЦИАЛИЗАЦИЯ И ЗАПУСК
// ==================================================
updateUI();
go('Лагерь');
log('Добро пожаловать в TSCHORNI WORLD!');
log('Переключай локации → бей мобов → добывай ресурсы → крафти → покупай шмот');
log('Прогресс сохраняется автоматически');
</script>
</body>
</html>
