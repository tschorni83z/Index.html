<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Carnage: Craft & Mine</title>
    <style>
        :root { --gold: #f1c40f; --bg: #121212; --panel: #222; --blue: #3498db; --red: #e74c3c; --green: #2ecc71; }
        body { background: var(--bg); color: #e0e0e0; font-family: sans-serif; margin: 0; padding: 10px; font-size: 14px; user-select: none; }
        
        .panel { background: var(--panel); padding: 12px; border-radius: 10px; border: 1px solid #333; margin-bottom: 8px; }
        
        /* –ü–æ–ª–æ—Å–∫–∏ HP */
        .hp-container { display: flex; align-items: center; gap: 8px; margin: 5px 0; font-size: 11px; }
        .hp-bar { flex-grow: 1; height: 10px; background: #000; border-radius: 5px; overflow: hidden; border: 1px solid #444; }
        .hp-fill { height: 100%; background: var(--green); width: 100%; transition: 0.3s; }

        .res-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; font-size: 11px; margin-top: 5px; color: #aaa; text-align: center; }
        
        #log { height: 120px; overflow-y: auto; background: #000; padding: 10px; font-size: 12px; border: 1px solid #333; margin-bottom: 8px; border-radius: 5px; color: #bbb; line-height: 1.4; }
        
        .screen { display: none; } 
        .active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        button { padding: 14px; background: #333; color: #fff; border: 1px solid #555; border-radius: 8px; font-weight: bold; font-size: 13px; }
        button:active { background: #444; transform: scale(0.98); }
        
        .btn-hunt { background: #6d214f; border: none; grid-column: span 2; margin-bottom: 10px; padding: 16px; }
        .btn-move { background: var(--blue); border: none; }
        .btn-craft { background: #d35400; border: none; }
        .btn-atk { background: var(--red); grid-column: span 2; margin-top: 10px; border: none; }
        
        .selected { background: #e67e22 !important; border-color: #ff9800 !important; box-shadow: 0 0 10px rgba(230, 126, 34, 0.5); }
        .loc-title { font-size: 18px; color: var(--gold); text-align: center; display: block; margin-bottom: 15px; font-weight: bold; }
    </style>
</head>
<body>

    <div class="panel">
        <div style="display:flex; justify-content:space-between; font-weight:bold; margin-bottom: 5px;">
            <span>–£—Ä. <span id="lvl">1</span></span>
            <span>üí∞ <span id="gold">20</span> | üè¶ <span id="bank">0</span></span>
        </div>
        <div class="hp-container">
            <span>HP</span>
            <div class="hp-bar"><div id="hp-fill" class="hp-fill"></div></div>
            <span id="hp-text">100/100</span>
        </div>
        <div class="res-grid">
            <span>ü™µ –î–µ—Ä–µ–≤–æ: <b id="r-wood">0</b></span>
            <span>ü™® –ö–∞–º–µ–Ω—å: <b id="r-stone">0</b></span>
            <span>‚õìÔ∏è –ñ–µ–ª–µ–∑–æ: <b id="r-iron">0</b></span>
        </div>
    </div>

    <div id="log">–ó–∞–≥—Ä—É–∑–∫–∞ –º–∏—Ä–∞ Carnage...</div>

    <div id="scr-world" class="screen active">
        <span class="loc-title" id="loc-name">–õ–æ–∫–∞—Ü–∏—è</span>
        <button id="btn-hunt" class="btn-hunt" onclick="hunt()">üîç –ù–ê–ô–¢–ò –ú–û–ù–°–¢–†–ê</button>  
        <div class="grid" id="nav-btns"></div>
        <div id="act-btns" class="grid" style="margin-top:10px;"></div>
    </div>

    <div id="scr-battle" class="screen">
        <span class="loc-title">‚öîÔ∏è –ë–û–ô: <span id="en-name">–í—Ä–∞–≥</span></span>
        <div class="grid">
            <button id="atk1" onclick="sel('atk',1,'–ì–æ–ª–æ–≤–∞')">–ê—Ç–∫: –ì–æ–ª–æ–≤–∞</button>
            <button id="def1" onclick="sel('def',1,'–ì–æ–ª–æ–≤–∞')">–ó–∞—â: –ì–æ–ª–æ–≤–∞</button>
            <button id="atk2" onclick="sel('atk',2,'–¢–µ–ª–æ')">–ê—Ç–∫: –¢–µ–ª–æ</button>
            <button id="def2" onclick="sel('def',2,'–¢–µ–ª–æ')">–ó–∞—â: –¢–µ–ª–æ</button>
            <button class="btn-atk" onclick="doTurn()">–ù–ê–ù–ï–°–¢–ò –£–î–ê–†</button>
        </div>
    </div>

    <script>
        const world = {
            'town': { n: '–ì–æ—Ä–æ–¥ (–ë–µ–∑–æ–ø–∞—Å–Ω–æ)', paths: ['forest_res', 'mine', 'forest_danger', 'bank'], acts: [{t: '–ö—Ä–∞—Ñ—Ç: –ú–µ—á (10 –¥–µ—Ä–µ–≤–∞/5 –∂–µ–ª)', f: 'craft'}] },
            'bank': { n: '–ì–æ—Ä–æ–¥—Å–∫–æ–π –ë–∞–Ω–∫', paths: ['town'], acts: [{t: '–í–Ω–µ—Å—Ç–∏ –≤—Å—ë –∑–æ–ª–æ—Ç–æ', f: 'dep'}, {t: '–ó–∞–±—Ä–∞—Ç—å –≤—Å—ë –∑–æ–ª–æ—Ç–æ', f: 'with'}] },
            'forest_res': { n: '–õ–µ—Å —Ä–µ—Å—É—Ä—Å–æ–≤ (–ú–∏—Ä–Ω–æ)', paths: ['town'], acts: [{t: '–†—É–±–∏—Ç—å –¥–µ—Ä–µ–≤–æ', f: 'gather_wood'}] },
            'mine': { n: '–ì–ª—É–±–æ–∫–∞—è –®–∞—Ö—Ç–∞', paths: ['town'], acts: [{t: '–î–æ–±—ã–≤–∞—Ç—å –∫–∞–º–µ–Ω—å', f: 'gather_stone'}, {t: '–ò—Å–∫–∞—Ç—å –∂–µ–ª–µ–∑–æ', f: 'gather_iron'}] },
            'forest_danger': { n: '–î–∏–∫–∏–π –õ–µ—Å (–û–ø–∞—Å–Ω–æ)', paths: ['town'], mob: '–°–≤–∏—Ä–µ–ø—ã–π –û—Ä–∫', hp: 80 }
        };

        let p = JSON.parse(localStorage.getItem('c_save_v4')) || {
            hp: 100, mH: 100, g: 20, b: 0, lvl: 1, loc: 'town',
            wood: 0, stone: 0, iron: 0, dmgBonus: 0
        };
        let enemy = null, sAtk = '', sDef = '';

        function move(k) {
            p.loc = k; 
            const l = world[k];
            document.getElementById('loc-name').innerText = l.n;
            document.getElementById('btn-hunt').style.display = l.mob ? 'block' : 'none';
            
            const nB = document.getElementById('nav-btns'); nB.innerHTML = '';
            l.paths.forEach(pk => {
                let b = document.createElement('button'); b.className = 'btn-move';
                b.innerText = `‚û° ${world[pk].n}`; b.onclick = () => move(pk);
                nB.appendChild(b);
            });

            const aB = document.getElementById('act-btns'); aB.innerHTML = '';
            if(l.acts) l.acts.forEach(a => {
                let b = document.createElement('button'); b.className = 'btn-craft';
                b.innerText = a.t; b.onclick = () => window[a.f]();
                aB.appendChild(b);
            });
            update();
        }

        // –†–ï–°–£–†–°–´
        window.gather_wood = () => { p.wood += 2; addLog("ü™µ –í—ã —Å—Ä—É–±–∏–ª–∏ 2 –¥–µ—Ä–µ–≤–∞."); update(); };
        window.gather_stone = () => { p.stone += 2; addLog("ü™® –í—ã –¥–æ–±—ã–ª–∏ 2 –∫–∞–º–Ω—è."); update(); };
        window.gather_iron = () => { 
            if(Math.random() > 0.5) { p.iron += 1; addLog("‚õìÔ∏è –í—ã –Ω–∞—à–ª–∏ –∂–µ–ª–µ–∑–Ω—É—é —Ä—É–¥—É!"); } 
            else { addLog("...—Ç–æ–ª—å–∫–æ –ø—É—Å—Ç—ã–µ –∫–∞–º–Ω–∏."); }
            update(); 
        };
        
        window.craft = () => {
            if(p.wood >= 10 && p.iron >= 5) {
                p.wood -= 10; p.iron -= 5; p.dmgBonus += 15;
                addLog("‚öîÔ∏è –í—ã —Å–∫–æ–≤–∞–ª–∏ –°—Ç–∞–ª—å–Ω–æ–π –ú–µ—á! –£—Ä–æ–Ω –Ω–∞–≤—Å–µ–≥–¥–∞ —É–≤–µ–ª–∏—á–µ–Ω –Ω–∞ 15.");
            } else {
                addLog("‚ùå –ù—É–∂–Ω–æ 10 –¥–µ—Ä–µ–≤–∞ –∏ 5 –∂–µ–ª–µ–∑–∞!");
            }
            update();
        };

        window.dep = () => { if(p.g > 0){ p.b += p.g; p.g = 0; addLog("üí∞ –ó–æ–ª–æ—Ç–æ –Ω–∞ —Ö—Ä–∞–Ω–µ–Ω–∏–∏."); } update(); };
        window.with = () => { if(p.b > 0){ p.g += p.b; p.b = 0; addLog("üí∞ –í—ã –∑–∞–±—Ä–∞–ª–∏ –∑–æ–ª–æ—Ç–æ."); } update(); };

        // –ë–û–ô
        function hunt() {
            const l = world[p.loc];
            if(l.mob) startBattle(l.mob, l.hp + (p.lvl * 10));
        }

        function startBattle(n, h) {
            enemy = { n, hp: h, max: h, dmg: 10 + p.lvl };
            document.getElementById('en-name').innerText = n;
            document.getElementById('scr-world').classList.remove('active');
            document.getElementById('scr-battle').classList.add('active');
            addLog(`üëπ –í–ù–ò–ú–ê–ù–ò–ï: –ù–∞ –≤–∞—Å –Ω–∞–ø–∞–ª ${n}!`);
        }

        function sel(t, i, n) {
            for(let j=1; j<=2; j++) document.getElementById(t+j).classList.remove('selected');
            document.getElementById(t+i).classList.add('selected');
            if(t==='atk') sAtk = n; else sDef = n;
        }

        function doTurn() {
            if(!sAtk || !sDef) { alert("–í—ã–±–µ—Ä–∏ –∑–æ–Ω—ã –∞—Ç–∞–∫–∏ –∏ –∑–∞—â–∏—Ç—ã!"); return; }
            
            // –ò–≥—Ä–æ–∫ –∞—Ç–∞–∫—É–µ—Ç
            let d = 10 + p.lvl + p.dmgBonus + Math.floor(Math.random() * 5);
            enemy.hp -= d; addLog(`–í—ã —É–¥–∞—Ä–∏–ª–∏ –≤ ${sAtk}: -${d} HP.`);
            
            if(enemy.hp <= 0) {
                p.g += 30; addLog("üèÜ –ü–æ–±–µ–¥–∞! –í—ã –ø–æ–ª—É—á–∏–ª–∏ 30 –∑–æ–ª–æ—Ç—ã—Ö –º–æ–Ω–µ—Ç.");
                endBattle();
            } else {
                // –í—Ä–∞–≥ –∞—Ç–∞–∫—É–µ—Ç
                let eAtk = Math.random() > 0.5 ? '–ì–æ–ª–æ–≤–∞' : '–¢–µ–ª–æ';
                if(eAtk === sDef) {
                    addLog(`üõ°Ô∏è –ë–ª–æ–∫! –í—ã –æ—Ç—Ä–∞–∑–∏–ª–∏ —É–¥–∞—Ä –≤ ${eAtk}.`);
                } else {
                    p.hp -= enemy.dmg; 
                    addLog(`<span style="color:var(--red)">–í—Ä–∞–≥ –ø–æ–ø–∞–ª –≤ ${eAtk}: -${enemy.dmg} HP.</span>`);
                }
            }

            if(p.hp <= 0) { 
                addLog("üíÄ –í—ã –ø–æ–≥–∏–±–ª–∏! –ó–æ–ª–æ—Ç–æ –∏–∑ –∫–∞—Ä–º–∞–Ω–æ–≤ –ø–æ—Ç–µ—Ä—è–Ω–æ."); 
                p.hp = p.mH; p.g = 0; 
                endBattle();
                move('town'); 
            }
            update();
        }

        function endBattle() {
            enemy = null; sAtk = ''; sDef = '';
            document.querySelectorAll('button').forEach(b => b.classList.remove('selected'));
            document.getElementById('scr-battle').classList.remove('active');
            document.getElementById('scr-world').classList.add('active');
        }

        function addLog(m) {
            const l = document.getElementById('log');
            l.innerHTML += `<div>${m}</div>`; 
            l.scrollTop = l.scrollHeight;
        }

        function update() {
            // –†–µ—Å—É—Ä—Å—ã –∏ —Å—Ç–∞—Ç—ã
            document.getElementById('gold').innerText = p.g;
            document.getElementById('bank').innerText = p.b;
            document.getElementById('r-wood').innerText = p.wood;
            document.getElementById('r-stone').innerText = p.stone;
            document.getElementById('r-iron').innerText = p.iron;
            document.getElementById('lvl').innerText = p.lvl;
            
            // HP –ø–æ–ª–æ—Å–∫–∞
            let hpProc = (p.hp / p.mH) * 100;
            document.getElementById('hp-fill').style.width = hpProc + "%";
            document.getElementById('hp-text').innerText = Math.max(0, p.hp) + "/" + p.mH;
            
            localStorage.setItem('c_save_v4', JSON.stringify(p));
        }

        move('town');
    </script>
</body>
</html>
