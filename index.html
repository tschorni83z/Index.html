<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TSCHORNI: MOB HUNTER</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      background:#000;
      color:#e0e0e0;
      font-family:Arial, Helvetica, sans-serif;
      font-size:13px;
      line-height:1.4;
      overflow:hidden;
      height:100vh;
    }
    #container {
      height:100vh;
      display:flex;
      flex-direction:column;
    }
    #header {
      background:#111;
      border-bottom:2px solid #400;
      padding:8px 12px;
      color:#ff6600;
      font-size:18px;
      font-weight:bold;
      text-align:center;
    }
    #topbar {
      background:#1a1a1a;
      border-bottom:1px solid #333;
      padding:6px 12px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      font-size:14px;
    }
    #topbar span { color:#ffcc00; }
    #bars {
      padding:8px 12px;
      background:#111;
      border-bottom:1px solid #400;
    }
    .bar {
      height:18px;
      background:#222;
      border:1px solid #444;
      border-radius:3px;
      margin:6px 0;
      position:relative;
      overflow:hidden;
    }
    .fill {
      height:100%;
      transition:width 0.5s ease;
    }
    .hp .fill { background:linear-gradient(to right, #c00, #800); }
    .st .fill { background:linear-gradient(to right, #ffcc00, #cc9900); }
    .label {
      position:absolute;
      inset:0;
      text-align:center;
      line-height:18px;
      color:#fff;
      font-size:11px;
      text-shadow:1px 1px #000;
    }
    #content {
      flex:1;
      padding:12px;
      overflow-y:auto;
      background:#0d0d0d;
    }
    #log {
      background:#000;
      border:1px solid #400;
      border-radius:4px;
      padding:8px;
      margin-top:12px;
      max-height:180px;
      overflow-y:auto;
      font-size:12px;
      color:#0f8;
    }
    #bottombar {
      background:#111;
      border-top:2px solid #400;
      padding:8px 12px;
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      justify-content:center;
    }
    button {
      background:#400;
      color:#ffcc00;
      border:1px solid #800;
      padding:8px 14px;
      border-radius:4px;
      cursor:pointer;
      font-size:14px;
      min-width:90px;
    }
    button:hover {
      background:#600;
      border-color:#a00;
    }
    button:disabled {
      background:#222;
      color:#555;
      border-color:#444;
      cursor:not-allowed;
    }
    .panel {
      background:#111;
      border:1px solid #400;
      border-radius:6px;
      padding:12px;
      margin:12px auto;
      max-width:600px;
      display:none;
    }
    .item {
      background:#1a1a1a;
      border:1px solid #400;
      border-radius:4px;
      padding:8px;
      margin:6px 0;
    }
  </style>
</head>
<body>

<div id="container">
  <div id="header">TSCHORNI: MOB HUNTER</div>

  <div id="topbar">
    <span id="name">Герой</span>
    <span id="lvl">1 ур.</span>
    <span id="gold">0 зол.</span>
  </div>

  <div id="bars">
    <div class="bar hp">
      <div class="fill" id="hp-fill" style="width:100%"></div>
      <div class="label" id="hp-label">HP 100/100</div>
    </div>
    <div class="bar st">
      <div class="fill" id="st-fill" style="width:100%"></div>
      <div class="label" id="st-label">Выносливость 100/100</div>
    </div>
  </div>

  <div id="content">
    <div id="log"></div>
  </div>

  <div id="bottombar">
    <button onclick="go('Лагерь')">Лагерь</button>
    <button onclick="go('Лес')">Лес</button>
    <button onclick="go('Шахта')">Шахта</button>
    <button onclick="go('Город')">Город</button>
    <button onclick="showInv()">Инвентарь</button>
    <button onclick="showCraft()">Крафт</button>
    <button onclick="showShop()">Магазин</button>
    <button onclick="die()">Умереть</button>
  </div>
</div>

<div id="inv" class="panel">
  <h2>Инвентарь</h2>
  <div id="inv-list"></div>
  <h3>Экипировка</h3>
  <div id="equip-list"></div>
  <hr>
  <button onclick="closePanel('inv')">Закрыть</button>
</div>

<div id="craft" class="panel">
  <h2>Крафт</h2>
  <div id="craft-list"></div>
  <hr>
  <button onclick="closePanel('craft')">Закрыть</button>
</div>

<div id="shop" class="panel">
  <h2>Магазин</h2>
  <div id="shop-list"></div>
  <hr>
  <button onclick="closePanel('shop')">Закрыть</button>
</div>

  <script>
// ==================================================
// ДАННЫЕ ИГРОКА
// ==================================================
let player = JSON.parse(localStorage.getItem('tschorniWorld')) || {
  name: "Герой",
  level: 1,
  exp: 0,
  expToNext: 100,
  hp: 100,
  maxHp: 100,
  stamina: 100,
  maxStamina: 100,
  gold: 0,
  str: 5,
  vit: 5,
  location: "Лагерь",
  inventory: [
    {id:"rKnife", name:"Ржавый нож", type:"weapon", str:3, count:1},
    {id:"rags", name:"Тряпьё", type:"armor", vit:2, count:1}
  ],
  equip: {
    weapon: {id:"rKnife", name:"Ржавый нож", str:3},
    armor: {id:"rags", name:"Тряпьё", vit:2}
  },
  resources: { wood:0, ore:0, herb:0 }
};

function save() {
  localStorage.setItem('tschorniWorld', JSON.stringify(player));
}

// ==================================================
// ЛОГ + ПРОГРЕСС-ДЕЙСТВИЯ
// ==================================================
function log(txt, color = '#0f8') {
  const div = document.createElement('div');
  div.textContent = txt;
  div.style.color = color;
  document.getElementById('log').appendChild(div);
  div.scrollIntoView({behavior:'smooth'});
  if (document.getElementById('log').children.length > 20) {
    document.getElementById('log').removeChild(document.getElementById('log').firstChild);
  }
}

function progressAction(callback, duration = 1200) {
  const progress = document.createElement('div');
  progress.className = 'progress-line';
  const fill = document.createElement('div');
  fill.className = 'progress-fill';
  progress.appendChild(fill);
  document.getElementById('content').prepend(progress);

  let start = null;
  function animate(timestamp) {
    if (!start) start = timestamp;
    const elapsed = timestamp - start;
    const progressVal = Math.min(1, elapsed / duration);
    fill.style.width = (progressVal * 100) + '%';
    if (elapsed < duration) {
      requestAnimationFrame(animate);
    } else {
      progress.remove();
      callback();
    }
  }
  requestAnimationFrame(animate);
}

// ==================================================
// ОБНОВЛЕНИЕ ИНТЕРФЕЙСА
// ==================================================
function updateUI() {
  document.getElementById('name').textContent = player.name;
  document.getElementById('lvl').textContent = `${player.level} ур.`;
  document.getElementById('gold').textContent = `${player.gold} золота`;

  const hpPerc = Math.min(100, (player.hp / player.maxHp) * 100);
  document.getElementById('hp-fill').style.width = hpPerc + '%';
  document.getElementById('hp-label').textContent = `HP ${Math.floor(player.hp)}/${player.maxHp}`;

  const stPerc = Math.min(100, (player.stamina / player.maxStamina) * 100);
  document.getElementById('st-fill').style.width = stPerc + '%';
  document.getElementById('st-label').textContent = `Выносливость ${Math.floor(player.stamina)}/${player.maxStamina}`;
}

// ==================================================
// ПЕРЕХОД В ЛОКАЦИЮ
// ==================================================
function go(loc) {
  if (player.location === loc) return;
  progressAction(() => {
    player.location = loc;
    log(`→ ${loc}`, '#ffcc00');
    updateUI();
    renderMobs();
  });
}

// ==================================================
// МОБЫ И БОЙ (с уровнями)
// ==================================================
let mobs = [];

function renderMobs() {
  const list = document.getElementById('mobs-list');
  list.innerHTML = '';
  if (player.location === 'Лагерь' || player.location === 'Город') {
    list.innerHTML = '<p>Здесь безопасно</p>';
    return;
  }
  const mobTypes = player.location === 'Лес' ? ['Волк', 'Гоблин', 'Олень'] : ['Скелет', 'Гоблин-шахтёр', 'Паук'];
  for (let i = 0; i < 3; i++) {
    const name = mobTypes[Math.floor(Math.random() * mobTypes.length)];
    const level = Math.max(1, player.level - 1 + Math.floor(Math.random() * 4));
    const mob = {
      name,
      level,
      hp: 40 + level * 15 + Math.floor(Math.random() * 30),
      maxHp: 0,
      dmg: level + 5,
      exp: 25 + level * 10,
      gold: 8 + level * 5 + Math.floor(Math.random() * 15)
    };
    mob.maxHp = mob.hp;
    mobs.push(mob);
    list.innerHTML += `
      <div class="mob">
        ${mob.name} (ур. ${mob.level}) (${mob.hp}/${mob.maxHp}) 
        <button onclick="hitMob(${i})">Ударить (${player.str + (player.equip.weapon?.str || 0)} dmg)</button>
      </div>`;
  }
}

function hitMob(index) {
  if (!mobs[index] || player.hp <= 0 || player.stamina < 10) return;
  player.stamina -= 10;
  let mob = mobs[index];
  let dmg = player.str + (player.equip.weapon?.str || 0) + Math.floor(Math.random() * 6);
  mob.hp -= dmg;
  log(`→ ${dmg} урона ${mob.name}`, '#ff4444');

  if (mob.hp <= 0) {
    log(`Убит ${mob.name} (ур. ${mob.level})!`, '#00ff00');
    player.exp += mob.exp;
    player.gold += mob.gold;
    mobs.splice(index, 1);

    while (player.exp >= player.expToNext) {
      player.level++;
      player.exp -= player.expToNext;
      player.expToNext = Math.floor(player.expToNext * 1.7);
      player.str += 2;
      player.vit += 2;
      player.maxHp += 30;
      player.hp = player.maxHp;
      log(`Уровень ${player.level}! +2 STR +2 VIT +30 HP`, '#ffff00');
    }
  } else {
    let mobDmg = Math.max(1, mob.dmg - Math.floor(player.vit / 3) - (player.equip.armor?.vit || 0));
    player.hp -= mobDmg;
    log(`${mob.name} → ${mobDmg}`, '#ff4444');
    if (player.hp <= 0) {
      log('Вы мертвы!', '#ff0000');
      player.hp = 1;
    }
  }

  updateUI();
  renderMobs();
}

// ==================================================
// ИНВЕНТАРЬ
// ==================================================
function showInv() {
  closeAllPanels();
  const list = document.getElementById('inv-list');
  list.innerHTML = '';
  player.inventory.forEach((item, i) => {
    let btn = '';
    if (item.type === 'weapon' && (!player.equip.weapon || player.equip.weapon.id !== item.id)) {
      btn += `<button onclick="equip(${i}, 'weapon')">Надеть</button>`;
    }
    if (item.type === 'armor' && (!player.equip.armor || player.equip.armor.id !== item.id)) {
      btn += `<button onclick="equip(${i}, 'armor')">Надеть</button>`;
    }
    list.innerHTML += `<div class="item">${item.name} x${item.count || 1} ${btn}</div>`;
  });

  const eq = document.getElementById('equip-list');
  eq.innerHTML = '';
  if (player.equip.weapon) eq.innerHTML += `<div class="item eq">Оружие: ${player.equip.weapon.name} (+${player.equip.weapon.str} STR)</div>`;
  if (player.equip.armor) eq.innerHTML += `<div class="item eq">Броня: ${player.equip.armor.name} (+${player.equip.armor.vit} VIT)</div>`;

  document.getElementById('inv').style.display = 'block';
}

function closeInv() {
  document.getElementById('inv').style.display = 'none';
}

// ==================================================
// МАГАЗИН
// ==================================================
function showShop() {
  if (player.location !== 'Город') {
    log('Магазин только в Городе', '#ff4444');
    return;
  }
  closeAllPanels();
  const items = [
    {id:'knife2', name:'Железный нож', type:'weapon', str:8, price:150},
    {id:'leather', name:'Кожаная куртка', type:'armor', vit:8, price:200},
    {id:'potion', name:'Зелье лечения', type:'consumable', price:50}
  ];

  let html = '';
  items.forEach(it => {
    html += `<div class="item">${it.name} — ${it.price} зол. <button onclick="buy('${it.id}',${it.price})">Купить</button></div>`;
  });

  document.getElementById('shop-list').innerHTML = html;
  document.getElementById('shop').style.display = 'block';
}

function closeShop() {
  document.getElementById('shop').style.display = 'none';
}

function buy(id, price) {
  if (player.gold < price) {
    log('Недостаточно золота', '#ff4444');
    return;
  }
  player.gold -= price;
  const item = {
    id, count:1,
    name: id === 'knife2' ? 'Железный нож' : id === 'leather' ? 'Кожаная куртка' : 'Зелье лечения',
    type: id === 'potion' ? 'consumable' : id.includes('knife') ? 'weapon' : 'armor',
    str: id === 'knife2' ? 8 : 0,
    vit: id === 'leather' ? 8 : 0
  };
  player.inventory.push(item);
  log(`Куплено: ${item.name}`, '#00ff00');
  save();
  updateUI();
}

// ==================================================
// КРАФТ
// ==================================================
function showCraft() {
  closeAllPanels();
  const recipes = [
    {result:{id:'ironKnife', name:'Железный нож', type:'weapon', str:12, count:1}, need:{ore:3, wood:1}},
    {result:{id:'ironArmor', name:'Железная броня', type:'armor', vit:12, count:1}, need:{ore:5, wood:2}}
  ];

  let html = '';
  recipes.forEach((r, i) => {
    let can = true;
    let needTxt = '';
    for (let res in r.need) {
      if ((player.resources[res] || 0) < r.need[res]) can = false;
      needTxt += `${r.need[res]} ${res} `;
    }
    html += `<div class="item">${r.result.name} — ${needTxt} <button ${can ? '' : 'disabled'} onclick="doCraft(${i})">Создать</button></div>`;
  });

  document.getElementById('craft-list').innerHTML = html;
  document.getElementById('craft').style.display = 'block';
}

function closeCraft() {
  document.getElementById('craft').style.display = 'none';
}

function doCraft(index) {
  const r = [
    {result:{id:'ironKnife', name:'Железный нож', type:'weapon', str:12, count:1}, need:{ore:3, wood:1}},
    {result:{id:'ironArmor', name:'Железная броня', type:'armor', vit:12, count:1}, need:{ore:5, wood:2}}
  ][index];

  for (let res in r.need) {
    player.resources[res] -= r.need[res];
  }
  player.inventory.push(r.result);
  log(`Создано: ${r.result.name}`, '#00ff00');
  save();
  updateUI();
  showCraft();
}

// ==================================================
// СМЕРТЬ
// ==================================================
function die() {
  log('Вы мертвы... Возрождение в Лагере', '#ff4444');
  player.hp = player.maxHp;
  player.stamina = player.maxStamina;
  player.exp = Math.floor(player.exp * 0.6);
  player.gold = Math.floor(player.gold * 0.5);
  player.location = 'Лагерь';
  save();
  updateUI();
  go('Лагерь');
}

// ==================================================
// ВСПОМОГАТЕЛЬНЫЕ ФУНКЦИИ
// ==================================================
function closeAllPanels() {
  ['inv', 'craft', 'shop'].forEach(id => {
    document.getElementById(id).style.display = 'none';
  });
}

function closePanel(id) {
  document.getElementById(id).style.display = 'none';
}

// ==================================================
// ЗАПУСК
// ==================================================
updateUI();
go('Лагерь');
log('Добро пожаловать в TSCHORNI: MOB HUNTER!', '#ff6600');
log('Переключай локации → бей мобов → крафти → покупай шмот');
log('Прогресс сохраняется автоматически');

// Восстановление выносливости
setInterval(() => {
  if (player.stamina < player.maxStamina) {
    player.stamina = Math.min(player.maxStamina, player.stamina + 1);
    updateUI();
  }
}, 2000);
</script>
</body>
</html>
